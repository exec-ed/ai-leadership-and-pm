<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pilot_data_qualitative</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="pilot_data_qualitative_files/libs/clipboard/clipboard.min.js"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/popper.min.js"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pilot_data_qualitative_files/libs/quarto-html/anchor.min.js"></script>
<link href="pilot_data_qualitative_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pilot_data_qualitative_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pilot_data_qualitative_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pilot_data_qualitative_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pilot_data_qualitative_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="pilot-data-qualitative-feedback" class="level1">
<h1>PILOT DATA: QUALITATIVE FEEDBACK</h1>
<section id="retailflow-ai-customer-service-pilot---week-6-summary" class="level2">
<h2 class="anchored" data-anchor-id="retailflow-ai-customer-service-pilot---week-6-summary">RetailFlow AI Customer Service Pilot - Week 6 Summary</h2>
<hr>
</section>
<section id="customer-interviews-survey-responses" class="level2">
<h2 class="anchored" data-anchor-id="customer-interviews-survey-responses">CUSTOMER INTERVIEWS &amp; SURVEY RESPONSES</h2>
<section id="customer-response-samples-week-5-6" class="level3">
<h3 class="anchored" data-anchor-id="customer-response-samples-week-5-6">Customer Response Samples (Week 5-6)</h3>
<p><strong>Customer #1: Positive Experience</strong> &gt; “I asked where my order was and got a response in 2 minutes. The tracking number was correct. Way better than waiting 24 hours for an email. If it’s always this fast, I’m happy.” &gt; &gt; Satisfaction: 9/10</p>
<hr>
<p><strong>Customer #2: Mixed Experience</strong> &gt; “The AI answered my return policy question, but then gave me conflicting information about sizing. I had to escalate to a human who clarified. Why would AI try to answer something it doesn’t understand?” &gt; &gt; Satisfaction: 6/10</p>
<hr>
<p><strong>Customer #3: Positive</strong> &gt; “Honestly expected this to be worse. AI got my order status right, and when I had a follow-up question, it escalated me to a human pretty quickly. Better than the old system where I’d wait forever.” &gt; &gt; Satisfaction: 8/10</p>
<hr>
<p><strong>Customer #4: Negative</strong> &gt; “AI told me my return had been processed when it actually hadn’t. I had to call back twice. This is exactly why I don’t trust AI. I want to talk to a real person.” &gt; &gt; Satisfaction: 3/10</p>
<hr>
<p><strong>Customer #5: Positive</strong> &gt; “I got an instant answer to a standard question. Didn’t need more help. This is perfect for what it is.” &gt; &gt; Satisfaction: 10/10</p>
<hr>
<p><strong>Customer #6: Mixed</strong> &gt; “The AI couldn’t understand that I wanted a specific size recommendation based on my body type. It just gave generic sizing. A human would have asked follow-up questions. I still like the speed though.” &gt; &gt; Satisfaction: 7/10</p>
<hr>
</section>
<section id="customer-sentiment-summary" class="level3">
<h3 class="anchored" data-anchor-id="customer-sentiment-summary">Customer Sentiment Summary</h3>
<p><strong>Positive Themes:</strong> - Speed (most appreciated feature) - Instant response vs.&nbsp;26-hour wait - Convenience - Works well for routine questions</p>
<p><strong>Negative Themes:</strong> - Sometimes AI gives wrong information - Can’t understand nuanced questions - Escalation process feels clunky - Distrust of AI in general</p>
<p><strong>Conditional Themes:</strong> - “I like it IF accuracy is high” - “Good for simple questions, but not complex ones” - “Better than nothing, but not better than a human”</p>
<hr>
</section>
</section>
<section id="team-feedback-detailed-notes" class="level2">
<h2 class="anchored" data-anchor-id="team-feedback-detailed-notes">TEAM FEEDBACK (Detailed Notes)</h2>
<section id="agent-1-sarah-star-agent---8-years-tenure" class="level3">
<h3 class="anchored" data-anchor-id="agent-1-sarah-star-agent---8-years-tenure">Agent 1 (Sarah, Star Agent - 8 Years Tenure)</h3>
<p><strong>Week 1-2 Sentiment:</strong> Resistant (“AI can’t do what we do”)</p>
<p><strong>Week 3-4 Sentiment:</strong> Shifting (“Actually, it does handle the routine stuff”)</p>
<p><strong>Week 5-6 Sentiment:</strong> Converted (“I use it for 95% of routine queries now”)</p>
<p><strong>Quote:</strong> &gt; “I was wrong about this. AI isn’t replacing me—it’s freeing me up. I’m now handling the customers with real problems, not answering ‘where’s my order’ for the 50th time. This is actually better. I want accuracy to improve so I can trust it more, but this works.”</p>
<p><strong>What Changed:</strong> Direct conversation with PM, being included in feedback process, seeing data on what AI actually does well</p>
<hr>
</section>
<section id="agent-2-mid-tenure-early-adopter" class="level3">
<h3 class="anchored" data-anchor-id="agent-2-mid-tenure-early-adopter">Agent 2 (Mid-Tenure, Early Adopter)</h3>
<p><strong>Usage:</strong> 80% of routine queries</p>
<p><strong>Quote:</strong> &gt; “I like it. It’s fast. Some accuracy issues, but mostly good. I just wish the escalation process was smoother—when I have to take over for the customer, it takes me a minute to understand the context.”</p>
<p><strong>Feedback:</strong> Process improvement (context passing)</p>
<hr>
</section>
<section id="agent-3-new-to-team-learning" class="level3">
<h3 class="anchored" data-anchor-id="agent-3-new-to-team-learning">Agent 3 (New to Team, Learning)</h3>
<p><strong>Usage:</strong> 70% of routine queries</p>
<p><strong>Quote:</strong> &gt; “I’m still learning when to use it and when not to use it. The product care questions are tricky. But for order tracking, it’s solid. I’ll probably use it more as I get more comfortable.”</p>
<p><strong>Feedback:</strong> More training needed on scope/boundaries</p>
<hr>
</section>
<section id="agent-4-prefers-manual" class="level3">
<h3 class="anchored" data-anchor-id="agent-4-prefers-manual">Agent 4 (Prefers Manual)</h3>
<p><strong>Usage:</strong> 60% of routine queries</p>
<p><strong>Quote:</strong> &gt; “I can see why people like it, but I’m faster doing it manually. Maybe I’m old school. If accuracy was higher, I’d probably trust it more and use it more.”</p>
<p><strong>Feedback:</strong> Needs to see accuracy improve to fully adopt</p>
<hr>
</section>
<section id="agent-5-holdout-still-skeptical" class="level3">
<h3 class="anchored" data-anchor-id="agent-5-holdout-still-skeptical">Agent 5 (Holdout, Still Skeptical)</h3>
<p><strong>Usage:</strong> 40% of routine queries</p>
<p><strong>Quote:</strong> &gt; “I still don’t trust it completely. What if it gives a customer wrong information and then they blame me? Also… I’ve been doing this job 5 years. Will I still have a job in 2 years?”</p>
<p><strong>Feedback:</strong> Job security concerns need to be addressed. Accuracy improvement might help.</p>
<hr>
</section>
<section id="team-consensus" class="level3">
<h3 class="anchored" data-anchor-id="team-consensus">Team Consensus</h3>
<blockquote class="blockquote">
<p>“AI should handle routine queries (order tracking, policy questions). It should NOT handle complaints, exceptions, or product care questions. Those need human expertise.”</p>
</blockquote>
<p><strong>Team Recommendation:</strong> “Expand AI carefully. Only to query types where accuracy is consistently 90%+. Keep humans for complex stuff.”</p>
<hr>
</section>
</section>
<section id="leadership-perspective-extended-interviews" class="level2">
<h2 class="anchored" data-anchor-id="leadership-perspective-extended-interviews">LEADERSHIP PERSPECTIVE (Extended Interviews)</h2>
<section id="ceo-vp-of-operations" class="level3">
<h3 class="anchored" data-anchor-id="ceo-vp-of-operations">CEO (VP of Operations)</h3>
<p><strong>Overall Assessment:</strong> &gt; “This is promising. Response times are great. Customer satisfaction is up. But I’m not ready to scale yet.”</p>
<p><strong>Key Concerns:</strong> - Accuracy at 88% is below my 90% threshold - Cost savings aren’t as high as projected - I need to see this work for 4 more weeks before I commit to full rollout</p>
<p><strong>What Would Change CEO’s Mind:</strong> - Accuracy hits 90%+ - Cost per query hits $12 or better - Team fully adopts (not just 75%) - No new crises in weeks 7-10</p>
<p><strong>Timeline Preference:</strong> &gt; “If accuracy improves in 4 weeks, I want to scale by Week 10. But I’m not forcing it. Data should drive the decision.”</p>
<hr>
</section>
<section id="cfo-finance" class="level3">
<h3 class="anchored" data-anchor-id="cfo-finance">CFO (Finance)</h3>
<p><strong>Budget Status:</strong> - Projected: $150K for 6-week pilot - Actual: $140K (under budget so far) - Cost per query: $14 (target: $12)</p>
<p><strong>ROI Calculation:</strong> &gt; “Right now, this costs MORE than it saves because we’re not at scale. But projections show: at 60% AI coverage, we save $180K annually. At 100%, we save $400K annually. That’s the case for scaling. But we need to GET to 60% first.”</p>
<p><strong>What Would Trigger CFO Approval:</strong> - Accuracy ≥90% (fewer errors, lower support costs) - Ability to expand to 60%+ volume - Clear path to $400K annual savings</p>
<hr>
</section>
<section id="data-scientist" class="level3">
<h3 class="anchored" data-anchor-id="data-scientist">Data Scientist</h3>
<p><strong>Technical Assessment:</strong> &gt; “The model is solid. Accuracy is 88% because we’re training on limited data (6 weeks of queries). With 4 more weeks of data + model refinement, I’m confident I can get to 92%.”</p>
<p><strong>What’s Holding Accuracy Back:</strong> - Product care questions (sizing, care instructions) need more training data - Rare exception cases (damaged goods, special requests) harder to classify - Misspellings in customer queries throw off classification</p>
<p><strong>4-Week Plan:</strong> - Collect 2 weeks more query data - Retrain model on expanded dataset - Fine-tune for product care queries specifically - Test on holdout dataset - Deploy refined model Week 10</p>
<p><strong>Risk Assessment:</strong> &gt; “I’m 80% confident I can hit 92%. There’s a 15% chance we get to 91% (still good). 5% chance we hit a wall at 89% (need to revisit approach).”</p>
<hr>
</section>
<section id="customer-service-manager" class="level3">
<h3 class="anchored" data-anchor-id="customer-service-manager">Customer Service Manager</h3>
<p><strong>Operational Status:</strong> &gt; “Everything is running smoothly. Sarah’s adoption is helping the rest of the team. No operational blockers.”</p>
<p><strong>Team Capacity for Scale:</strong> - Current team (5 agents) handles 100% of 2,500 queries/week - With 30% AI coverage, team handles 1,750 queries/week (each agent more focused, higher quality) - At 60% AI coverage, team would handle 1,000 queries/week - At 100% AI coverage, team would handle ~300 queries/week (exceptions only)</p>
<p><strong>What Team Needs for Scale:</strong> - Accuracy improvement (less rework) - Clear scope (which query types AI handles) - Training on escalation process - Job security clarity (“You’re not being replaced, you’re shifting to harder work”)</p>
<p><strong>Team Recommendation:</strong> &gt; “We’re ready to scale. My team understands the AI now. We trust it for routine queries. Just improve accuracy and we’re good.”</p>
<hr>
</section>
</section>
<section id="customer-support-quality-metrics" class="level2">
<h2 class="anchored" data-anchor-id="customer-support-quality-metrics">CUSTOMER SUPPORT QUALITY METRICS</h2>
<section id="escalation-analysis" class="level3">
<h3 class="anchored" data-anchor-id="escalation-analysis">Escalation Analysis</h3>
<p><strong>Why customers escalate from AI to human:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 25%">
<col style="width: 14%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>Reason</th>
<th>Count</th>
<th>%</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AI gave wrong info</td>
<td>45</td>
<td>35%</td>
<td>Wrong tracking number</td>
</tr>
<tr class="even">
<td>AI couldn’t understand question</td>
<td>35</td>
<td>27%</td>
<td>Specific sizing request</td>
</tr>
<tr class="odd">
<td>Customer asked for human</td>
<td>25</td>
<td>19%</td>
<td>“I want to talk to someone”</td>
</tr>
<tr class="even">
<td>AI offered multiple options</td>
<td>15</td>
<td>11%</td>
<td>“Which option is right for me?”</td>
</tr>
<tr class="odd">
<td>System error</td>
<td>10</td>
<td>8%</td>
<td>AI crashed, escalated to human</td>
</tr>
</tbody>
</table>
<p><strong>Insight:</strong> 35% of escalations are actual errors (fixable with better training). 27% are scope limitations (product care). 19% are customer preference (can’t fix). 11% are edge cases (fixable). 8% are technical issues (rare).</p>
<hr>
</section>
<section id="quality-issues-logged" class="level3">
<h3 class="anchored" data-anchor-id="quality-issues-logged">Quality Issues Logged</h3>
<p><strong>Week 1-2 (Crisis Period):</strong> - Multiple wrong tracking numbers - Outdated return policy info - Conflicting product information</p>
<p><strong>Week 3-4 (Stabilization):</strong> - Occasional misspelling confusion - Sizing questions misinterpreted - Rare wrong policy edge cases</p>
<p><strong>Week 5-6 (Stable):</strong> - Minimal errors - Mostly scope limitations (can’t answer product care) - No major quality incidents</p>
<p><strong>Trend:</strong> Quality improving, errors decreasing, remaining issues are mostly scope (not fixable with model improvement alone).</p>
<hr>
</section>
</section>
<section id="qualitative-themes" class="level2">
<h2 class="anchored" data-anchor-id="qualitative-themes">QUALITATIVE THEMES</h2>
<section id="whats-working-well" class="level3">
<h3 class="anchored" data-anchor-id="whats-working-well">What’s Working Well</h3>
<ol type="1">
<li><strong>Speed</strong> - Most valued by customers</li>
<li><strong>Routine queries</strong> - AI excels at order tracking, policy info</li>
<li><strong>Team adoption</strong> - 75% is solid, improving</li>
<li><strong>Escalation process</strong> - Works when needed</li>
<li><strong>Stability</strong> - No crashes, reliable after Week 1</li>
</ol>
</section>
<section id="what-needs-improvement" class="level3">
<h3 class="anchored" data-anchor-id="what-needs-improvement">What Needs Improvement</h3>
<ol type="1">
<li><strong>Accuracy</strong> - 88% is close but not 90%</li>
<li><strong>Product care</strong> - AI struggles with nuance</li>
<li><strong>Error messaging</strong> - Sometimes confuses customers</li>
<li><strong>Escalation context</strong> - Humans struggle to pick up where AI left off</li>
<li><strong>Job security messaging</strong> - 2 agents still worried</li>
</ol>
</section>
<section id="whats-out-of-scope" class="level3">
<h3 class="anchored" data-anchor-id="whats-out-of-scope">What’s Out of Scope</h3>
<ol type="1">
<li><strong>Complaints</strong> - Need human empathy</li>
<li><strong>Exceptions</strong> - Need human judgment</li>
<li><strong>Complex questions</strong> - Need human expertise</li>
<li><strong>Upset customers</strong> - Need human reassurance</li>
</ol>
<hr>
</section>
</section>
<section id="key-insights" class="level2">
<h2 class="anchored" data-anchor-id="key-insights">KEY INSIGHTS</h2>
<section id="for-executives" class="level3">
<h3 class="anchored" data-anchor-id="for-executives">For Executives</h3>
<blockquote class="blockquote">
<p>“This works. Customers like the speed. Team is adopting. We just need 4 more weeks to prove accuracy, then we can scale with confidence.”</p>
</blockquote>
</section>
<section id="for-data-science" class="level3">
<h3 class="anchored" data-anchor-id="for-data-science">For Data Science</h3>
<blockquote class="blockquote">
<p>“Accuracy is a solvable problem with more data and training time. You’ve proven the concept. Focus on product care queries for next iteration.”</p>
</blockquote>
</section>
<section id="for-operations" class="level3">
<h3 class="anchored" data-anchor-id="for-operations">For Operations</h3>
<blockquote class="blockquote">
<p>“Team is ready. No operational blockers. Make sure accuracy improves before scaling, but your side is good.”</p>
</blockquote>
</section>
<section id="for-product" class="level3">
<h3 class="anchored" data-anchor-id="for-product">For Product</h3>
<blockquote class="blockquote">
<p>“You’re right about scope. Stick to routine queries. Avoid exceptions, complaints, and product expertise questions. That’s where accuracy breaks.”</p>
</blockquote>
<hr>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>